import{g as Y,h as s,i as O,o as _,c as Z,d as I,a as t,w as u,F as ee,b as p,t as S,k as x,l as h}from"./index-180af58d.js";import{E as r,a as le,b as ae,c as te,d as ue,g as oe}from"./el-table-column-9b9bb6ff.js";import{E as re,a as se,b as ne,c as de}from"./el-button-b0604719.js";import{c as ie,m as ve,u as me,n as pe,h as ce,o as fe,E as ge,g as _e}from"./survey-15302bb4.js";const ye={style:{position:"absolute",width:"1000px",left:"240px",top:"120px",padding:"20px","border-radius":"5px","border-color":"rgb(200, 200, 200)","border-width":"1px","border-style":"solid"}},be=I("p",{style:{"margin-top":"0px","margin-left":"10px","font-weight":"600",color:"#00000072"}},"调查问卷选项表",-1),Ve={style:{color:"blue","margin-top":"0px"}},xe={style:{float:"left","margin-left":"100px","margin-top":"0px","margin-bottom":"0px",color:"red"}},Ce={__name:"survey_item",setup(he){Y(()=>{b()});const c=s([]),w=s([]),k=s(null),m=s(0),f=s(!1),y=s(!1),d=s(!1),o=s({id:null,item:"",userId:null}),n=s({colums:[],current:1,size:10,total:0}),J=O(()=>m.value===0?"新增":"修改"),i=s(""),P=O(()=>c.value.slice(n.value.size*(n.value.current-1),n.value.current*n.value.size)),B=()=>{c.value=A(c.value,"id")},D=l=>{for(var e=0;e<w.value.length;e++)if(w.value[e].id==l)return w.value[e];return{userName:"查询不到用户",userType:"查询不到用户"}};function A(l,e){return l.sort(function(v,V){var C=v[e],U=V[e];return C<U?-1:C>U?1:0})}const b=()=>{k.value===null?ie().then(l=>{l.success===!0?(c.value=l.data.surveyItems,n.value.total=c.value.length,B()):r.error("获取数据失败!")}).catch(l=>{console.log(l),r.error("获取数据失败!")}):ve(k.value).then(l=>{l.success===!0?(c.value=[l.data.surveyItem],n.value.total=c.value.length,B()):r.error("查询不到数据!")}).catch(l=>{console.log(l),r.error("查询不到数据!")}),me().then(l=>{l.success===!0&&(w.value=l.data.userinfos)}).catch(l=>{console.log(l)})},M=l=>{o.value=JSON.parse(JSON.stringify(l)),m.value=1,i.value="",F(),y.value=!1,d.value=!1,f.value=!0},$=l=>{pe(l.id).then(e=>{e.success===!0?(b(),r({message:"删除成功!",type:"success"})):r.error("删除失败!")}).catch(e=>{console.log(e),r.error("删除失败!")})},K=()=>{o.value={id:null,item:"",userId:null},m.value=0,i.value="",E.value="请输入用户编号进行查询",z.value="请输入用户编号进行查询",y.value=!1,d.value=!1,f.value=!0},j=()=>{if(i.value="",o.value.item===""){i.value="调查选项不能为空!";return}if(d.value&&(o.value.userId==null||o.value.userId==="")){i.value="用户编号不能为空!";return}m.value===0?q():G()},q=()=>{if(y.value||(o.value.id=null),!d.value){var l=JSON.parse(window.localStorage.getItem("userinfo"));o.value.userId=l.userinfo.id}ce(o.value).then(e=>{e.success===!0?(b(),f.value=!1,r({message:"添加成功!",type:"success"})):(r.error("添加数据失败!"),i.value="添加失败，编号或选项已存在!")}).catch(e=>{console.log(e),r.error("添加数据失败!"),i.value="添加失败，编号或选项已存在!"})},G=()=>{fe(o.value).then(l=>{l.success===!0?(b(),f.value=!1,r({message:"修改成功!",type:"success"})):r.error("修改失败!")}).catch(l=>{console.log(l),r.error("修改失败!"),i.value="修改失败!"})},E=s("请输入用户编号进行查询"),z=s("请输入用户编号进行查询"),F=()=>{if(o.value.userId==""){E.value="请输入用户编号进行查询",z.value="请输入用户编号进行查询";return}E.value=D(o.value.userId).userName,z.value=D(o.value.userId).userType},H=()=>{k.value=null,b()};return(l,e)=>{const v=re,V=ue,C=ge,U=_e,L=le,Q=ae,N=se,g=ne,T=oe,R=de,W=te;return _(),Z(ee,null,[I("div",ye,[be,t(v,{onClick:H,type:"primary",style:{position:"absolute",right:"120px",top:"17px"}},{default:u(()=>[p("刷新")]),_:1}),t(v,{onClick:K,type:"success",style:{float:"right","margin-top":"-40px","margin-left":"-120px"}},{default:u(()=>[p("添加数据")]),_:1}),t(L,{data:P.value,border:""},{default:u(()=>[t(V,{label:"编号",prop:"id",width:"100",sortable:""}),t(V,{label:"问卷选项",prop:"item",width:"500"}),t(V,{label:"创建用户",width:"200"},{default:u(a=>[p(S(D(a.row.userId).userName),1)]),_:1}),t(V,{align:"right",width:"200"},{header:u(()=>[t(C,{controls:!1,modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),size:"small",placeholder:"按编号查找",style:{width:"100px","margin-right":"20px"}},null,8,["modelValue"]),t(v,{size:"small",type:"primary",onClick:b},{default:u(()=>[p("搜索")]),_:1})]),default:u(a=>[t(v,{size:"small",onClick:X=>M(a.row)},{default:u(()=>[p("编辑")]),_:2},1032,["onClick"]),t(U,{title:"确认删除该记录?",onConfirm:X=>$(a.row)},{reference:u(()=>[t(v,{size:"small",type:"danger",onClick:e[1]||(e[1]=()=>{})},{default:u(()=>[p("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),t(Q,{onCurrentChange:e[2]||(e[2]=()=>{}),style:{float:"right","margin-top":"20px"},"page-size":n.value.size,"pager-count":11,layout:"prev, pager, next",total:n.value.total,"onUpdate:total":e[3]||(e[3]=a=>n.value.total=a),"current-page":n.value.current,"onUpdate:currentPage":e[4]||(e[4]=a=>n.value.current=a)},null,8,["page-size","total","current-page"])]),t(W,{modelValue:f.value,"onUpdate:modelValue":e[13]||(e[13]=a=>f.value=a),title:J.value,width:"30%"},{footer:u(()=>[I("span",null,[t(v,{onClick:e[12]||(e[12]=()=>{f.value=!1})},{default:u(()=>[p("取消")]),_:1}),t(v,{type:"primary",onClick:j},{default:u(()=>[p("确定")]),_:1})])]),default:u(()=>[t(R,{"label-width":"100px",style:{"max-width":"460px"}},{default:u(()=>[m.value===1?(_(),x(g,{key:0,label:"编号"},{default:u(()=>[t(N,{type:"number",disabled:"",modelValue:o.value.id,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.id=a),placeholder:"请输入编号"},null,8,["modelValue"])]),_:1})):h("",!0),t(g,{label:"问卷选项"},{default:u(()=>[t(N,{modelValue:o.value.item,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.item=a),placeholder:"请输入问卷选项"},null,8,["modelValue"])]),_:1}),m.value===0?(_(),x(g,{key:1,label:""},{default:u(()=>[t(T,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=a=>y.value=a),label:"自定义编号"},null,8,["modelValue"]),t(T,{modelValue:d.value,"onUpdate:modelValue":e[8]||(e[8]=a=>d.value=a),label:"自定义用户"},null,8,["modelValue"])]),_:1})):h("",!0),m.value===1?(_(),x(g,{key:2,label:""},{default:u(()=>[t(T,{modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value=a),label:"修改创建用户"},null,8,["modelValue"])]),_:1})):h("",!0),m.value===0&&y.value?(_(),x(g,{key:3,label:"编号"},{default:u(()=>[t(N,{type:"number",modelValue:o.value.id,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.id=a),placeholder:"请输入编号",clearable:""},null,8,["modelValue"])]),_:1})):h("",!0),d.value?(_(),x(g,{key:4,label:"用户编号"},{default:u(()=>[t(N,{onInput:F,type:"number",modelValue:o.value.userId,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.userId=a),placeholder:"请输入用户编号"},null,8,["modelValue"])]),_:1})):h("",!0),d.value?(_(),x(g,{key:5,label:"用户名"},{default:u(()=>[I("p",Ve,S(E.value),1)]),_:1})):h("",!0)]),_:1}),I("p",xe,S(i.value),1)]),_:1},8,["modelValue","title"])],64)}}};export{Ce as default};
