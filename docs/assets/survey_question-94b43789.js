import{g as ye,h as d,i as X,o as n,c as k,d as A,a as t,w as o,F as z,b as y,t as D,j as O,k as g,l as V}from"./index-180af58d.js";import{E as v,a as ge,b as _e,c as be,d as Ie,e as he,f as Ve,g as xe}from"./el-table-column-9b9bb6ff.js";import{E as ke,a as Ce,b as we,c as Ee}from"./el-button-b0604719.js";import{s as Ue,a as Ne,b as ze,c as Y,u as De,d as Se,e as Te,f as qe,E as Be,g as Oe,h as Ae}from"./survey-15302bb4.js";const Fe={style:{position:"absolute",width:"1000px",left:"240px",top:"120px",padding:"20px","border-radius":"5px","border-color":"rgb(200, 200, 200)","border-width":"1px","border-style":"solid"}},Pe=A("p",{style:{"margin-top":"0px","margin-left":"10px","font-weight":"600",color:"#00000072"}},"调查问卷试题表",-1),Je={style:{color:"blue","margin-top":"0px"}},Me={style:{float:"left","margin-left":"100px","margin-top":"0px","margin-bottom":"0px",color:"red"}},He={__name:"survey_question",setup(Qe){ye(()=>{U()});const C=d([]),S=d([]),m=d([{text:""}]),_=d([]),F=d([]),T=d(null),x=d(0),b=d(null),w=d(!1),E=d(!1),I=d(!1),u=d({id:null,content:"",description:"",surveyCateId:null,surveyItemIds:"",userId:null}),f=d({colums:[],current:1,size:5,total:0}),Z=X(()=>x.value===0?"新增":"修改"),i=d(""),j=X(()=>C.value.slice(f.value.size*(f.value.current-1),f.value.current*f.value.size)),G=()=>{C.value=te(C.value,"id")},J=l=>{for(var e=0;e<F.value.length;e++)if(F.value[e].id==l)return F.value[e];return{userName:"查询不到用户",userType:"查询不到用户"}},ee=l=>{for(var e=0;e<S.value.length;e++)if(S.value[e].id==l)return S.value[e];return{cateName:"查询不到类型"}},le=l=>{for(var e=0;e<_.value.length;e++)if(_.value[e].id==l)return _.value[e];return{item:"查询不到试题项"}},ae=l=>{var e=[],r=[];e=l.split(",");for(var s=0;s<e.length;s++)r.push(le(e[s]).item);return r};function te(l,e){return l.sort(function(r,s){var p=r[e],h=s[e];return p<h?-1:p>h?1:0})}const U=()=>{T.value===null?Ue().then(l=>{l.success===!0?(C.value=l.data.surveyQuestions,f.value.total=C.value.length,G()):v.error("获取数据失败!")}).catch(l=>{console.log(l),v.error("获取数据失败!")}):Ne(T.value).then(l=>{l.success===!0?(C.value=[l.data.surveyQuestion],f.value.total=C.value.length,G()):v.error("查询不到数据!")}).catch(l=>{console.log(l),v.error("查询不到数据!")}),ze().then(l=>{l.success===!0&&(S.value=l.data.surveyCates)}).catch(l=>{console.log(l)}),Y().then(l=>{l.success===!0&&(_.value=l.data.surveyItems)}).catch(l=>{console.log(l)}),De().then(l=>{l.success===!0&&(F.value=l.data.userinfos)}).catch(l=>{console.log(l)})},ue=l=>{u.value=JSON.parse(JSON.stringify(l)),x.value=1,i.value="",R(),u.value.surveyItemIds=u.value.surveyItemIds.split(",").map(Number),E.value=!1,I.value=!1,b.value=1,w.value=!0},oe=l=>{Se(l.id).then(e=>{e.success===!0?(U(),v({message:"删除成功!",type:"success"})):v.error("删除失败!")}).catch(e=>{console.log(e),v.error("删除失败!")})},re=()=>{u.value={id:null,content:"",description:"",surveyCateId:null,surveyItemIds:"",userId:null},x.value=0,i.value="",P.value="请输入用户编号进行查询",M.value="请输入用户编号进行查询",E.value=!1,I.value=!1,b.value=null,W(),w.value=!0},se=()=>{if(i.value="",u.value.content===""){i.value="问卷试题不能为空!";return}if(u.value.surveyCateId==null||u.value.surveyCateId===""){i.value="请选择问卷类型!";return}if(b.value==null){i.value="请选择选项来源!";return}if(b.value===0){for(var l=0;l<m.value.length;l++)if(m.value[l].text===""){i.value="请输入完整的选项内容!";return}}if(b.value===1&&u.value.surveyItemIds.length===0){i.value="请选择调查问卷项!";return}if(u.value.description===""){i.value="详细说明不能为空!";return}if(I.value&&(u.value.userId==null||u.value.userId==="")){i.value="用户编号不能为空!";return}x.value===0?de():ve()},H=l=>{for(var e="",r=0;r<l.length;r++)r===l.length-1?e+=l[r]:e+=l[r]+",";return e};function ne(){return new Promise((l,e)=>{for(var r=0,s=0;s<m.value.length;s++)Ae({item:m.value[s].text,userId:u.value.userId}).then(p=>{p.success===!0?(r++,r===m.value.length&&l("done")):(r++,r===m.value.length&&l("done"),v.error("选项添加失败!"))}).catch(p=>{r++,r===m.value.length&&l("done"),console.log(p),v.error("选项添加失败!")})})}async function de(){if(E.value||(u.value.id=null),!I.value){var l=JSON.parse(window.localStorage.getItem("userinfo"));u.value.userId=l.userinfo.id}u.value.surveyItemIds=H(u.value.surveyItemIds);let e=await ne();console.log(e),Y().then(r=>{if(r.success===!0){_.value=r.data.surveyItems;for(var s="",p=0;p<m.value.length;p++)for(var h=0;h<_.value.length;h++)_.value[h].item===m.value[p].text&&(s===""?s=_.value[h].id:s=s+","+_.value[h].id);u.value.surveyItemIds=s,Te(u.value).then(q=>{q.success===!0?(U(),w.value=!1,v({message:"添加成功!",type:"success"})):v.error("添加失败!")}).catch(q=>{console.log(q),v.error("添加失败!"),i.value="添加失败!"})}}).catch(r=>{console.log(r)})}const ve=()=>{u.value.surveyItemIds=H(u.value.surveyItemIds),qe(u.value).then(l=>{l.success===!0?(U(),w.value=!1,v({message:"修改成功!",type:"success"})):v.error("修改失败!")}).catch(l=>{console.log(l),v.error("修改失败!"),i.value="修改失败!"})},P=d("请输入用户编号进行查询"),M=d("请输入用户编号进行查询"),R=()=>{if(u.value.userId==""){P.value="请输入用户编号进行查询",M.value="请输入用户编号进行查询";return}P.value=J(u.value.userId).userName,M.value=J(u.value.userId).userType},ie=()=>{T.value=null,U()},ce=()=>{m.value.push({text:""})},W=()=>{m.value=[{text:""}]};return(l,e)=>{const r=ke,s=Ie,p=Be,h=Oe,q=ge,me=_e,N=Ce,c=we,Q=he,$=Ve,K=xe,pe=Ee,fe=be;return n(),k(z,null,[A("div",Fe,[Pe,t(r,{onClick:ie,type:"primary",style:{position:"absolute",right:"120px",top:"17px"}},{default:o(()=>[y("刷新")]),_:1}),t(r,{onClick:re,type:"success",style:{float:"right","margin-top":"-40px","margin-left":"-120px"}},{default:o(()=>[y("添加数据")]),_:1}),t(q,{data:j.value,border:""},{default:o(()=>[t(s,{label:"编号",prop:"id",width:"80",sortable:""}),t(s,{label:"问卷试题",prop:"content",width:"150"}),t(s,{label:"试题类型",width:"100"},{default:o(a=>[y(D(ee(a.row.surveyCateId).cateName),1)]),_:1}),t(s,{label:"选项列表",width:"200"},{default:o(a=>[(n(!0),k(z,null,O(ae(a.row.surveyItemIds),(B,L)=>(n(),k("div",null,D(L+1)+": "+D(B),1))),256))]),_:1}),t(s,{label:"详细说明",prop:"description",width:"150"}),t(s,{label:"创建用户",width:"120"},{default:o(a=>[y(D(J(a.row.userId).userName),1)]),_:1}),t(s,{align:"right",width:"200"},{header:o(()=>[t(p,{controls:!1,modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=a=>T.value=a),size:"small",placeholder:"按编号查找",style:{width:"100px","margin-right":"20px"}},null,8,["modelValue"]),t(r,{size:"small",type:"primary",onClick:U},{default:o(()=>[y("搜索")]),_:1})]),default:o(a=>[t(r,{size:"small",onClick:B=>ue(a.row)},{default:o(()=>[y("编辑")]),_:2},1032,["onClick"]),t(h,{title:"确认删除该记录?",onConfirm:B=>oe(a.row)},{reference:o(()=>[t(r,{size:"small",type:"danger",onClick:e[1]||(e[1]=()=>{})},{default:o(()=>[y("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),t(me,{onCurrentChange:e[2]||(e[2]=()=>{}),style:{float:"right","margin-top":"20px"},"page-size":f.value.size,"pager-count":11,layout:"prev, pager, next",total:f.value.total,"onUpdate:total":e[3]||(e[3]=a=>f.value.total=a),"current-page":f.value.current,"onUpdate:currentPage":e[4]||(e[4]=a=>f.value.current=a)},null,8,["page-size","total","current-page"])]),t(fe,{modelValue:w.value,"onUpdate:modelValue":e[17]||(e[17]=a=>w.value=a),title:Z.value,width:"30%"},{footer:o(()=>[A("span",null,[t(r,{onClick:e[16]||(e[16]=()=>{w.value=!1})},{default:o(()=>[y("取消")]),_:1}),t(r,{type:"primary",onClick:se},{default:o(()=>[y("确定")]),_:1})])]),default:o(()=>[t(pe,{"label-width":"100px",style:{"max-width":"460px"}},{default:o(()=>[x.value===1?(n(),g(c,{key:0,label:"编号"},{default:o(()=>[t(N,{type:"number",disabled:"",modelValue:u.value.id,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.id=a),placeholder:"请输入编号"},null,8,["modelValue"])]),_:1})):V("",!0),t(c,{label:"问卷试题"},{default:o(()=>[t(N,{modelValue:u.value.content,"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.content=a),placeholder:"请输入问卷试题"},null,8,["modelValue"])]),_:1}),t(c,{label:"试题类型"},{default:o(()=>[t($,{modelValue:u.value.surveyCateId,"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.surveyCateId=a),class:"m-2",placeholder:"请选择问卷类型"},{default:o(()=>[(n(!0),k(z,null,O(S.value,a=>(n(),g(Q,{key:a.id,label:a.cateName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),x.value===0?(n(),g(c,{key:1,label:"选项来源"},{default:o(()=>[t($,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=a=>b.value=a),class:"m-2",placeholder:"请选择选项来源"},{default:o(()=>[(n(),k(z,null,O([{id:0,title:"创建新选项"},{id:1,title:"从已有选项中选择"}],a=>t(Q,{key:a.id,label:a.title,value:a.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):V("",!0),b.value===0?(n(!0),k(z,{key:2},O(m.value,(a,B)=>(n(),k("div",null,[t(c,{label:"选项"+(B+1)},{default:o(()=>[t(N,{modelValue:a.text,"onUpdate:modelValue":L=>a.text=L,placeholder:"请输入选项内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]))),256)):V("",!0),b.value===0?(n(),g(c,{key:3,label:""},{default:o(()=>[t(r,{onClick:ce},{default:o(()=>[y("继续添加")]),_:1}),t(r,{onClick:W},{default:o(()=>[y("重置")]),_:1})]),_:1})):V("",!0),b.value===1?(n(),g(c,{key:4,label:"选项列表"},{default:o(()=>[t($,{modelValue:u.value.surveyItemIds,"onUpdate:modelValue":e[9]||(e[9]=a=>u.value.surveyItemIds=a),class:"m-2",placeholder:"请选择调查问卷项",multiple:!0},{default:o(()=>[(n(!0),k(z,null,O(_.value,a=>(n(),g(Q,{key:a.id,label:a.item,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):V("",!0),t(c,{label:"详细说明"},{default:o(()=>[t(N,{modelValue:u.value.description,"onUpdate:modelValue":e[10]||(e[10]=a=>u.value.description=a),placeholder:"请输入详细说明"},null,8,["modelValue"])]),_:1}),x.value===0?(n(),g(c,{key:5,label:""},{default:o(()=>[t(K,{modelValue:E.value,"onUpdate:modelValue":e[11]||(e[11]=a=>E.value=a),label:"自定义编号"},null,8,["modelValue"]),t(K,{modelValue:I.value,"onUpdate:modelValue":e[12]||(e[12]=a=>I.value=a),label:"自定义用户"},null,8,["modelValue"])]),_:1})):V("",!0),x.value===1?(n(),g(c,{key:6,label:""},{default:o(()=>[t(K,{modelValue:I.value,"onUpdate:modelValue":e[13]||(e[13]=a=>I.value=a),label:"修改创建用户"},null,8,["modelValue"])]),_:1})):V("",!0),x.value===0&&E.value?(n(),g(c,{key:7,label:"编号"},{default:o(()=>[t(N,{type:"number",modelValue:u.value.id,"onUpdate:modelValue":e[14]||(e[14]=a=>u.value.id=a),placeholder:"请输入编号",clearable:""},null,8,["modelValue"])]),_:1})):V("",!0),I.value?(n(),g(c,{key:8,label:"用户编号"},{default:o(()=>[t(N,{onInput:R,type:"number",modelValue:u.value.userId,"onUpdate:modelValue":e[15]||(e[15]=a=>u.value.userId=a),placeholder:"请输入用户编号"},null,8,["modelValue"])]),_:1})):V("",!0),I.value?(n(),g(c,{key:9,label:"用户名"},{default:o(()=>[A("p",Je,D(P.value),1)]),_:1})):V("",!0)]),_:1}),A("p",Me,D(i.value),1)]),_:1},8,["modelValue","title"])],64)}}};export{He as default};
